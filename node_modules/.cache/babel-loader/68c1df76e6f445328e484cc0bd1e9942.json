{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar react_1 = require(\"react\");\n\nvar fast_deep_equal_1 = tslib_1.__importDefault(require(\"fast-deep-equal\"));\n\nvar utilities_1 = require(\"../../utilities\");\n\nvar reducer_1 = require(\"./reducer\");\n\nfunction useDynamicList(initialList, factory, validateFunction, validationDependencies) {\n  if (validationDependencies === void 0) {\n    validationDependencies = [];\n  }\n\n  var _a = tslib_1.__read(react_1.useState(initialList ? initialList : []), 2),\n      calculatedList = _a[0],\n      setCalculatedLists = _a[1];\n\n  var validates = validateFunction ? validateFunction : {};\n\n  var _b = tslib_1.__read(reducer_1.useListReducer(calculatedList), 2),\n      state = _b[0],\n      dispatch = _b[1];\n\n  react_1.useEffect(function () {\n    if (!fast_deep_equal_1.default(calculatedList, state.initial)) {\n      dispatch(reducer_1.reinitializeAction(calculatedList));\n    }\n  }, [calculatedList, state.initial, dispatch]);\n  var validationConfigs = react_1.useMemo(function () {\n    return utilities_1.mapObject(validates, utilities_1.normalizeValidation);\n  }, tslib_1.__spread([validates], validationDependencies));\n\n  function addField() {\n    var fields = calculatedList;\n    fields.push();\n    setCalculatedLists(fields);\n    dispatch(reducer_1.addFieldsAction([factory()]));\n  }\n\n  function removeField(index) {\n    dispatch(reducer_1.removeFieldsAction(index));\n  }\n\n  var handlers = react_1.useMemo(function () {\n    return state.list.map(function (item, index) {\n      return utilities_1.mapObject(item, function (field, key) {\n        var target = {\n          index: index,\n          key: key\n        };\n\n        function validate(value) {\n          if (value === void 0) {\n            value = field.value;\n          }\n\n          var validates = validationConfigs[key];\n\n          if (validates == null) {\n            return;\n          }\n\n          var siblings = state.list.filter(function (listItem) {\n            return listItem !== item;\n          });\n          return runValidation(function (error) {\n            return dispatch(reducer_1.updateErrorAction({\n              target: target,\n              error: error || ''\n            }));\n          }, {\n            value: value,\n            siblings: siblings,\n            listItem: item\n          }, validates);\n        }\n\n        return {\n          onChange: function (value) {\n            var normalizedValue = utilities_1.isChangeEvent(value) ? value.target.value : value;\n            dispatch(reducer_1.updateAction({\n              target: target,\n              value: normalizedValue\n            }));\n\n            if (field.error) {\n              validate(normalizedValue);\n            }\n          },\n          reset: function () {\n            dispatch(reducer_1.resetAction({\n              target: target\n            }));\n          },\n          newDefaultValue: function (value) {\n            dispatch(reducer_1.newDefaultAction({\n              target: target,\n              value: value\n            }));\n          },\n          runValidation: validate,\n          onBlur: function () {\n            var touched = field.touched,\n                error = field.error;\n\n            if (touched === false && error == null) {\n              return;\n            }\n\n            validate();\n          },\n          setError: function (error) {\n            dispatch(reducer_1.updateErrorAction({\n              target: target,\n              error: error\n            }));\n          }\n        };\n      });\n    });\n  }, [dispatch, state.list, validationConfigs]);\n  var fields = react_1.useMemo(function () {\n    return state.list.map(function (item, index) {\n      return utilities_1.mapObject(item, function (field, key) {\n        return tslib_1.__assign(tslib_1.__assign({}, field), handlers[index][key]);\n      });\n    });\n  }, [state.list, handlers]);\n  return {\n    fields: fields,\n    addField: addField,\n    removeField: removeField\n  };\n}\n\nexports.useDynamicList = useDynamicList;\n\nfunction runValidation(updateError, state, validators) {\n  var value = state.value,\n      listItem = state.listItem,\n      siblings = state.siblings;\n  var error = validators.map(function (check) {\n    return check(value, {\n      listItem: listItem,\n      siblings: siblings\n    });\n  }).filter(function (value) {\n    return value != null;\n  });\n\n  if (error && error.length > 0) {\n    var _a = tslib_1.__read(error, 1),\n        firstError = _a[0];\n\n    updateError(firstError);\n    return firstError;\n  }\n\n  updateError(undefined);\n}","map":{"version":3,"sources":["/Users/timi/Desktop/typescript-test/node_modules/@shopify/react-form/dist/src/hooks/list/dynamiclist.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","react_1","fast_deep_equal_1","__importDefault","utilities_1","reducer_1","useDynamicList","initialList","factory","validateFunction","validationDependencies","_a","__read","useState","calculatedList","setCalculatedLists","validates","_b","useListReducer","state","dispatch","useEffect","default","initial","reinitializeAction","validationConfigs","useMemo","mapObject","normalizeValidation","__spread","addField","fields","push","addFieldsAction","removeField","index","removeFieldsAction","handlers","list","map","item","field","key","target","validate","siblings","filter","listItem","runValidation","error","updateErrorAction","onChange","normalizedValue","isChangeEvent","updateAction","reset","resetAction","newDefaultValue","newDefaultAction","onBlur","touched","setError","__assign","updateError","validators","check","length","firstError","undefined"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar react_1 = require(\"react\");\nvar fast_deep_equal_1 = tslib_1.__importDefault(require(\"fast-deep-equal\"));\nvar utilities_1 = require(\"../../utilities\");\nvar reducer_1 = require(\"./reducer\");\nfunction useDynamicList(initialList, factory, validateFunction, validationDependencies) {\n    if (validationDependencies === void 0) { validationDependencies = []; }\n    var _a = tslib_1.__read(react_1.useState(initialList ? initialList : []), 2), calculatedList = _a[0], setCalculatedLists = _a[1];\n    var validates = validateFunction ? validateFunction : {};\n    var _b = tslib_1.__read(reducer_1.useListReducer(calculatedList), 2), state = _b[0], dispatch = _b[1];\n    react_1.useEffect(function () {\n        if (!fast_deep_equal_1.default(calculatedList, state.initial)) {\n            dispatch(reducer_1.reinitializeAction(calculatedList));\n        }\n    }, [calculatedList, state.initial, dispatch]);\n    var validationConfigs = react_1.useMemo(function () {\n        return utilities_1.mapObject(validates, utilities_1.normalizeValidation);\n    }, tslib_1.__spread([validates], validationDependencies));\n    function addField() {\n        var fields = calculatedList;\n        fields.push();\n        setCalculatedLists(fields);\n        dispatch(reducer_1.addFieldsAction([factory()]));\n    }\n    function removeField(index) {\n        dispatch(reducer_1.removeFieldsAction(index));\n    }\n    var handlers = react_1.useMemo(function () {\n        return state.list.map(function (item, index) {\n            return utilities_1.mapObject(item, function (field, key) {\n                var target = { index: index, key: key };\n                function validate(value) {\n                    if (value === void 0) { value = field.value; }\n                    var validates = validationConfigs[key];\n                    if (validates == null) {\n                        return;\n                    }\n                    var siblings = state.list.filter(function (listItem) { return listItem !== item; });\n                    return runValidation(function (error) {\n                        return dispatch(reducer_1.updateErrorAction({ target: target, error: error || '' }));\n                    }, { value: value, siblings: siblings, listItem: item }, validates);\n                }\n                return {\n                    onChange: function (value) {\n                        var normalizedValue = (utilities_1.isChangeEvent(value)\n                            ? value.target.value\n                            : value);\n                        dispatch(reducer_1.updateAction({\n                            target: target,\n                            value: normalizedValue,\n                        }));\n                        if (field.error) {\n                            validate(normalizedValue);\n                        }\n                    },\n                    reset: function () {\n                        dispatch(reducer_1.resetAction({ target: target }));\n                    },\n                    newDefaultValue: function (value) {\n                        dispatch(reducer_1.newDefaultAction({ target: target, value: value }));\n                    },\n                    runValidation: validate,\n                    onBlur: function () {\n                        var touched = field.touched, error = field.error;\n                        if (touched === false && error == null) {\n                            return;\n                        }\n                        validate();\n                    },\n                    setError: function (error) {\n                        dispatch(reducer_1.updateErrorAction({ target: target, error: error }));\n                    },\n                };\n            });\n        });\n    }, [dispatch, state.list, validationConfigs]);\n    var fields = react_1.useMemo(function () {\n        return state.list.map(function (item, index) {\n            return utilities_1.mapObject(item, function (field, key) {\n                return tslib_1.__assign(tslib_1.__assign({}, field), handlers[index][key]);\n            });\n        });\n    }, [state.list, handlers]);\n    return { fields: fields, addField: addField, removeField: removeField };\n}\nexports.useDynamicList = useDynamicList;\nfunction runValidation(updateError, state, validators) {\n    var value = state.value, listItem = state.listItem, siblings = state.siblings;\n    var error = validators\n        .map(function (check) {\n        return check(value, {\n            listItem: listItem,\n            siblings: siblings,\n        });\n    })\n        .filter(function (value) { return value != null; });\n    if (error && error.length > 0) {\n        var _a = tslib_1.__read(error, 1), firstError = _a[0];\n        updateError(firstError);\n        return firstError;\n    }\n    updateError(undefined);\n}\n"]},"metadata":{},"sourceType":"script"}