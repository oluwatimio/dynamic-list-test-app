{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar react_1 = require(\"react\");\n\nvar fast_deep_equal_1 = tslib_1.__importDefault(require(\"fast-deep-equal\"));\n\nvar utilities_1 = require(\"../../utilities\");\n\nvar reducer_1 = require(\"./reducer\");\n\nfunction useDynamicList(listOrConfig, factory, validationDependencies) {\n  if (validationDependencies === void 0) {\n    validationDependencies = [];\n  }\n\n  var calculatedList = Array.isArray(listOrConfig) ? listOrConfig : listOrConfig.list;\n  var validates = Array.isArray(listOrConfig) ? {} : listOrConfig.validates || {}; // const [calculatedList] = useState<Item[]>(initialList);\n\n  var _a = tslib_1.__read(reducer_1.useListReducer(calculatedList), 2),\n      state = _a[0],\n      dispatch = _a[1];\n\n  react_1.useEffect(function () {\n    if (!fast_deep_equal_1.default(calculatedList, state.initial)) {\n      dispatch(reducer_1.reinitializeAction(calculatedList));\n    }\n  }, [calculatedList, state.initial, dispatch]);\n  var validationConfigs = react_1.useMemo(function () {\n    return utilities_1.mapObject(validates, utilities_1.normalizeValidation);\n  }, tslib_1.__spread([validates], validationDependencies));\n\n  function addField() {\n    dispatch(reducer_1.addFieldsAction([factory()]));\n  }\n\n  function removeField(index) {\n    dispatch(reducer_1.removeFieldsAction(index));\n  }\n\n  var handlers = react_1.useMemo(function () {\n    return state.list.map(function (item, index) {\n      return utilities_1.mapObject(item, function (field, key) {\n        var target = {\n          index: index,\n          key: key\n        };\n\n        function validate(value) {\n          if (value === void 0) {\n            value = field.value;\n          }\n\n          var validates = validationConfigs[key];\n\n          if (validates == null) {\n            return;\n          }\n\n          var siblings = state.list.filter(function (listItem) {\n            return listItem !== item;\n          });\n          return runValidation(function (error) {\n            return dispatch(reducer_1.updateErrorAction({\n              target: target,\n              error: error || ''\n            }));\n          }, {\n            value: value,\n            siblings: siblings,\n            listItem: item\n          }, validates);\n        }\n\n        return {\n          onChange: function (value) {\n            var normalizedValue = utilities_1.isChangeEvent(value) ? value.target.value : value;\n            dispatch(reducer_1.updateAction({\n              target: target,\n              value: normalizedValue\n            }));\n\n            if (field.error) {\n              validate(normalizedValue);\n            }\n          },\n          reset: function () {\n            dispatch(reducer_1.resetAction({\n              target: target\n            }));\n          },\n          newDefaultValue: function (value) {\n            dispatch(reducer_1.newDefaultAction({\n              target: target,\n              value: value\n            }));\n          },\n          runValidation: validate,\n          onBlur: function () {\n            var touched = field.touched,\n                error = field.error;\n\n            if (touched === false && error == null) {\n              return;\n            }\n\n            validate();\n          },\n          setError: function (error) {\n            dispatch(reducer_1.updateErrorAction({\n              target: target,\n              error: error\n            }));\n          }\n        };\n      });\n    });\n  }, [dispatch, state.list, validationConfigs]);\n  var fields = react_1.useMemo(function () {\n    return state.list.map(function (item, index) {\n      return utilities_1.mapObject(item, function (field, key) {\n        return tslib_1.__assign(tslib_1.__assign({}, field), handlers[index][key]);\n      });\n    });\n  }, [state.list, handlers]);\n  return {\n    fields: fields,\n    addField: addField,\n    removeField: removeField\n  };\n}\n\nexports.useDynamicList = useDynamicList;\n\nfunction runValidation(updateError, state, validators) {\n  var value = state.value,\n      listItem = state.listItem,\n      siblings = state.siblings;\n  var error = validators.map(function (check) {\n    return check(value, {\n      listItem: listItem,\n      siblings: siblings\n    });\n  }).filter(function (value) {\n    return value != null;\n  });\n\n  if (error && error.length > 0) {\n    var _a = tslib_1.__read(error, 1),\n        firstError = _a[0];\n\n    updateError(firstError);\n    return firstError;\n  }\n\n  updateError(undefined);\n}","map":{"version":3,"sources":["/Users/timi/Desktop/typescript-test/node_modules/@shopify/react-form/dist/src/hooks/list/dynamiclist.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","react_1","fast_deep_equal_1","__importDefault","utilities_1","reducer_1","useDynamicList","listOrConfig","factory","validationDependencies","calculatedList","Array","isArray","list","validates","_a","__read","useListReducer","state","dispatch","useEffect","default","initial","reinitializeAction","validationConfigs","useMemo","mapObject","normalizeValidation","__spread","addField","addFieldsAction","removeField","index","removeFieldsAction","handlers","map","item","field","key","target","validate","siblings","filter","listItem","runValidation","error","updateErrorAction","onChange","normalizedValue","isChangeEvent","updateAction","reset","resetAction","newDefaultValue","newDefaultAction","onBlur","touched","setError","fields","__assign","updateError","validators","check","length","firstError","undefined"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar react_1 = require(\"react\");\nvar fast_deep_equal_1 = tslib_1.__importDefault(require(\"fast-deep-equal\"));\nvar utilities_1 = require(\"../../utilities\");\nvar reducer_1 = require(\"./reducer\");\nfunction useDynamicList(listOrConfig, factory, validationDependencies) {\n    if (validationDependencies === void 0) { validationDependencies = []; }\n    var calculatedList = Array.isArray(listOrConfig)\n        ? listOrConfig\n        : listOrConfig.list;\n    var validates = Array.isArray(listOrConfig)\n        ? {}\n        : listOrConfig.validates || {};\n    // const [calculatedList] = useState<Item[]>(initialList);\n    var _a = tslib_1.__read(reducer_1.useListReducer(calculatedList), 2), state = _a[0], dispatch = _a[1];\n    react_1.useEffect(function () {\n        if (!fast_deep_equal_1.default(calculatedList, state.initial)) {\n            dispatch(reducer_1.reinitializeAction(calculatedList));\n        }\n    }, [calculatedList, state.initial, dispatch]);\n    var validationConfigs = react_1.useMemo(function () {\n        return utilities_1.mapObject(validates, utilities_1.normalizeValidation);\n    }, tslib_1.__spread([validates], validationDependencies));\n    function addField() {\n        dispatch(reducer_1.addFieldsAction([factory()]));\n    }\n    function removeField(index) {\n        dispatch(reducer_1.removeFieldsAction(index));\n    }\n    var handlers = react_1.useMemo(function () {\n        return state.list.map(function (item, index) {\n            return utilities_1.mapObject(item, function (field, key) {\n                var target = { index: index, key: key };\n                function validate(value) {\n                    if (value === void 0) { value = field.value; }\n                    var validates = validationConfigs[key];\n                    if (validates == null) {\n                        return;\n                    }\n                    var siblings = state.list.filter(function (listItem) { return listItem !== item; });\n                    return runValidation(function (error) {\n                        return dispatch(reducer_1.updateErrorAction({ target: target, error: error || '' }));\n                    }, { value: value, siblings: siblings, listItem: item }, validates);\n                }\n                return {\n                    onChange: function (value) {\n                        var normalizedValue = (utilities_1.isChangeEvent(value)\n                            ? value.target.value\n                            : value);\n                        dispatch(reducer_1.updateAction({\n                            target: target,\n                            value: normalizedValue,\n                        }));\n                        if (field.error) {\n                            validate(normalizedValue);\n                        }\n                    },\n                    reset: function () {\n                        dispatch(reducer_1.resetAction({ target: target }));\n                    },\n                    newDefaultValue: function (value) {\n                        dispatch(reducer_1.newDefaultAction({ target: target, value: value }));\n                    },\n                    runValidation: validate,\n                    onBlur: function () {\n                        var touched = field.touched, error = field.error;\n                        if (touched === false && error == null) {\n                            return;\n                        }\n                        validate();\n                    },\n                    setError: function (error) {\n                        dispatch(reducer_1.updateErrorAction({ target: target, error: error }));\n                    },\n                };\n            });\n        });\n    }, [dispatch, state.list, validationConfigs]);\n    var fields = react_1.useMemo(function () {\n        return state.list.map(function (item, index) {\n            return utilities_1.mapObject(item, function (field, key) {\n                return tslib_1.__assign(tslib_1.__assign({}, field), handlers[index][key]);\n            });\n        });\n    }, [state.list, handlers]);\n    return { fields: fields, addField: addField, removeField: removeField };\n}\nexports.useDynamicList = useDynamicList;\nfunction runValidation(updateError, state, validators) {\n    var value = state.value, listItem = state.listItem, siblings = state.siblings;\n    var error = validators\n        .map(function (check) {\n        return check(value, {\n            listItem: listItem,\n            siblings: siblings,\n        });\n    })\n        .filter(function (value) { return value != null; });\n    if (error && error.length > 0) {\n        var _a = tslib_1.__read(error, 1), firstError = _a[0];\n        updateError(firstError);\n        return firstError;\n    }\n    updateError(undefined);\n}\n"]},"metadata":{},"sourceType":"script"}