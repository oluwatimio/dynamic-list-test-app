{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar react_1 = require(\"react\");\n\nvar fast_deep_equal_1 = tslib_1.__importDefault(require(\"fast-deep-equal\"));\n\nvar utilities_1 = require(\"../../utilities\");\n\nvar reducer_1 = require(\"./reducer\");\n\nfunction useDynamicList(initialList, factory, validateFunction, validationDependencies) {\n  if (validationDependencies === void 0) {\n    validationDependencies = [];\n  }\n\n  var _a = tslib_1.__read(react_1.useState(initialList), 1),\n      calculatedList = _a[0];\n\n  var validates = validateFunction ? validateFunction : {};\n\n  var _b = tslib_1.__read(reducer_1.useListReducer(calculatedList), 2),\n      state = _b[0],\n      dispatch = _b[1];\n\n  react_1.useEffect(function () {\n    if (!fast_deep_equal_1.default(calculatedList, state.initial)) {\n      dispatch(reducer_1.reinitializeAction(calculatedList));\n    }\n  }, [calculatedList, state.initial, dispatch]);\n  var validationConfigs = react_1.useMemo(function () {\n    return utilities_1.mapObject(validates, utilities_1.normalizeValidation);\n  }, tslib_1.__spread([validates], validationDependencies));\n\n  function addField() {\n    dispatch(reducer_1.addFieldsAction([factory()]));\n  }\n\n  function removeField(index) {\n    dispatch(reducer_1.removeFieldsAction(index));\n  }\n\n  var handlers = react_1.useMemo(function () {\n    return state.list.map(function (item, index) {\n      return utilities_1.mapObject(item, function (field, key) {\n        var target = {\n          index: index,\n          key: key\n        };\n\n        function validate(value) {\n          if (value === void 0) {\n            value = field.value;\n          }\n\n          var validates = validationConfigs[key];\n\n          if (validates == null) {\n            return;\n          }\n\n          var siblings = state.list.filter(function (listItem) {\n            return listItem !== item;\n          });\n          return runValidation(function (error) {\n            return dispatch(reducer_1.updateErrorAction({\n              target: target,\n              error: error || ''\n            }));\n          }, {\n            value: value,\n            siblings: siblings,\n            listItem: item\n          }, validates);\n        }\n\n        return {\n          onChange: function (value) {\n            var normalizedValue = utilities_1.isChangeEvent(value) ? value.target.value : value;\n            dispatch(reducer_1.updateAction({\n              target: target,\n              value: normalizedValue\n            }));\n\n            if (field.error) {\n              validate(normalizedValue);\n            }\n          },\n          reset: function () {\n            dispatch(reducer_1.resetAction({\n              target: target\n            }));\n          },\n          newDefaultValue: function (value) {\n            dispatch(reducer_1.newDefaultAction({\n              target: target,\n              value: value\n            }));\n          },\n          runValidation: validate,\n          onBlur: function () {\n            var touched = field.touched,\n                error = field.error;\n\n            if (touched === false && error == null) {\n              return;\n            }\n\n            validate();\n          },\n          setError: function (error) {\n            dispatch(reducer_1.updateErrorAction({\n              target: target,\n              error: error\n            }));\n          }\n        };\n      });\n    });\n  }, [dispatch, state.list, validationConfigs]);\n  var fields = react_1.useMemo(function () {\n    return state.list.map(function (item, index) {\n      return utilities_1.mapObject(item, function (field, key) {\n        return tslib_1.__assign(tslib_1.__assign({}, field), handlers[index][key]);\n      });\n    });\n  }, [state.list, handlers]);\n  return {\n    fields: fields,\n    addField: addField,\n    removeField: removeField\n  };\n}\n\nexports.useDynamicList = useDynamicList;\n\nfunction runValidation(updateError, state, validators) {\n  var value = state.value,\n      listItem = state.listItem,\n      siblings = state.siblings;\n  var error = validators.map(function (check) {\n    return check(value, {\n      listItem: listItem,\n      siblings: siblings\n    });\n  }).filter(function (value) {\n    return value != null;\n  });\n\n  if (error && error.length > 0) {\n    var _a = tslib_1.__read(error, 1),\n        firstError = _a[0];\n\n    updateError(firstError);\n    return firstError;\n  }\n\n  updateError(undefined);\n}","map":{"version":3,"sources":["/Users/timi/Desktop/typescript-test/node_modules/@shopify/react-form/dist/src/hooks/list/dynamiclist.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","react_1","fast_deep_equal_1","__importDefault","utilities_1","reducer_1","useDynamicList","initialList","factory","validateFunction","validationDependencies","_a","__read","useState","calculatedList","validates","_b","useListReducer","state","dispatch","useEffect","default","initial","reinitializeAction","validationConfigs","useMemo","mapObject","normalizeValidation","__spread","addField","addFieldsAction","removeField","index","removeFieldsAction","handlers","list","map","item","field","key","target","validate","siblings","filter","listItem","runValidation","error","updateErrorAction","onChange","normalizedValue","isChangeEvent","updateAction","reset","resetAction","newDefaultValue","newDefaultAction","onBlur","touched","setError","fields","__assign","updateError","validators","check","length","firstError","undefined"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar react_1 = require(\"react\");\nvar fast_deep_equal_1 = tslib_1.__importDefault(require(\"fast-deep-equal\"));\nvar utilities_1 = require(\"../../utilities\");\nvar reducer_1 = require(\"./reducer\");\nfunction useDynamicList(initialList, factory, validateFunction, validationDependencies) {\n    if (validationDependencies === void 0) { validationDependencies = []; }\n    var _a = tslib_1.__read(react_1.useState(initialList), 1), calculatedList = _a[0];\n    var validates = validateFunction ? validateFunction : {};\n    var _b = tslib_1.__read(reducer_1.useListReducer(calculatedList), 2), state = _b[0], dispatch = _b[1];\n    react_1.useEffect(function () {\n        if (!fast_deep_equal_1.default(calculatedList, state.initial)) {\n            dispatch(reducer_1.reinitializeAction(calculatedList));\n        }\n    }, [calculatedList, state.initial, dispatch]);\n    var validationConfigs = react_1.useMemo(function () {\n        return utilities_1.mapObject(validates, utilities_1.normalizeValidation);\n    }, tslib_1.__spread([validates], validationDependencies));\n    function addField() {\n        dispatch(reducer_1.addFieldsAction([factory()]));\n    }\n    function removeField(index) {\n        dispatch(reducer_1.removeFieldsAction(index));\n    }\n    var handlers = react_1.useMemo(function () {\n        return state.list.map(function (item, index) {\n            return utilities_1.mapObject(item, function (field, key) {\n                var target = { index: index, key: key };\n                function validate(value) {\n                    if (value === void 0) { value = field.value; }\n                    var validates = validationConfigs[key];\n                    if (validates == null) {\n                        return;\n                    }\n                    var siblings = state.list.filter(function (listItem) { return listItem !== item; });\n                    return runValidation(function (error) {\n                        return dispatch(reducer_1.updateErrorAction({ target: target, error: error || '' }));\n                    }, { value: value, siblings: siblings, listItem: item }, validates);\n                }\n                return {\n                    onChange: function (value) {\n                        var normalizedValue = (utilities_1.isChangeEvent(value)\n                            ? value.target.value\n                            : value);\n                        dispatch(reducer_1.updateAction({\n                            target: target,\n                            value: normalizedValue,\n                        }));\n                        if (field.error) {\n                            validate(normalizedValue);\n                        }\n                    },\n                    reset: function () {\n                        dispatch(reducer_1.resetAction({ target: target }));\n                    },\n                    newDefaultValue: function (value) {\n                        dispatch(reducer_1.newDefaultAction({ target: target, value: value }));\n                    },\n                    runValidation: validate,\n                    onBlur: function () {\n                        var touched = field.touched, error = field.error;\n                        if (touched === false && error == null) {\n                            return;\n                        }\n                        validate();\n                    },\n                    setError: function (error) {\n                        dispatch(reducer_1.updateErrorAction({ target: target, error: error }));\n                    },\n                };\n            });\n        });\n    }, [dispatch, state.list, validationConfigs]);\n    var fields = react_1.useMemo(function () {\n        return state.list.map(function (item, index) {\n            return utilities_1.mapObject(item, function (field, key) {\n                return tslib_1.__assign(tslib_1.__assign({}, field), handlers[index][key]);\n            });\n        });\n    }, [state.list, handlers]);\n    return { fields: fields, addField: addField, removeField: removeField };\n}\nexports.useDynamicList = useDynamicList;\nfunction runValidation(updateError, state, validators) {\n    var value = state.value, listItem = state.listItem, siblings = state.siblings;\n    var error = validators\n        .map(function (check) {\n        return check(value, {\n            listItem: listItem,\n            siblings: siblings,\n        });\n    })\n        .filter(function (value) { return value != null; });\n    if (error && error.length > 0) {\n        var _a = tslib_1.__read(error, 1), firstError = _a[0];\n        updateError(firstError);\n        return firstError;\n    }\n    updateError(undefined);\n}\n"]},"metadata":{},"sourceType":"script"}