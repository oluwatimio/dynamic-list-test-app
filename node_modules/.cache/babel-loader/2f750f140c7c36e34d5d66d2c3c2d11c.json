{"ast":null,"code":"import { Key } from '../../../../types.js';\nimport { objectSpread2 as _objectSpread2 } from '../../../../_virtual/_rollupPluginBabelHelpers.js';\nimport React$1, { useState, useCallback, useEffect } from 'react';\nimport { EventListener as EventListener$1 } from '../../../EventListener/EventListener.js';\nimport { useUniqueId } from '../../../../utilities/unique-id/hooks.js';\nimport { KeypressListener as KeypressListener$1 } from '../../../KeypressListener/KeypressListener.js';\nimport { Popover as Popover$1 } from '../../../Popover/Popover.js';\nimport { ActionList as ActionList$1 } from '../../../ActionList/ActionList.js';\nimport { useToggle as useToggle$1 } from '../../../../utilities/use-toggle.js';\nimport { OptionList as OptionList$1 } from '../../../OptionList/OptionList.js';\nimport { ComboBoxContext } from './context.js';\nimport styles from './ComboBox.scss.js';\n\nfunction ComboBox({\n  id: idProp,\n  options,\n  selected,\n  textField,\n  preferredPosition,\n  listTitle,\n  allowMultiple,\n  actionsBefore,\n  actionsAfter,\n  contentBefore,\n  contentAfter,\n  emptyState,\n  onSelect,\n  onEndReached\n}) {\n  const [selectedIndex, setSelectedIndex] = useState(-1);\n  const [selectedOptions, setSelectedOptions] = useState(selected);\n  const [navigableOptions, setNavigableOptions] = useState([]);\n  const {\n    value: popoverActive,\n    setTrue: forcePopoverActiveTrue,\n    setFalse: forcePopoverActiveFalse\n  } = useToggle$1(false);\n  const id = useUniqueId('ComboBox', idProp);\n  const getActionsWithIds = useCallback((actions, before) => {\n    if (before) {\n      return navigableOptions.slice(0, actions.length);\n    }\n\n    return navigableOptions.slice(-actions.length);\n  }, [navigableOptions]);\n  const visuallyUpdateSelectedOption = useCallback((newOption, oldOption) => {\n    if (oldOption) {\n      oldOption.active = false;\n    }\n\n    if (newOption) {\n      newOption.active = true;\n    }\n  }, []);\n  const resetVisuallySelectedOptions = useCallback(() => {\n    setSelectedIndex(-1);\n    navigableOptions.forEach(option => {\n      option.active = false;\n    });\n  }, [navigableOptions]);\n  const selectOptionAtIndex = useCallback(newOptionIndex => {\n    if (navigableOptions.length === 0) {\n      return;\n    }\n\n    const oldSelectedOption = navigableOptions[selectedIndex];\n    const newSelectedOption = navigableOptions[newOptionIndex];\n    visuallyUpdateSelectedOption(newSelectedOption, oldSelectedOption);\n    setSelectedIndex(newOptionIndex);\n  }, [navigableOptions, selectedIndex, visuallyUpdateSelectedOption]);\n  const selectNextOption = useCallback(() => {\n    if (navigableOptions.length === 0) {\n      return;\n    }\n\n    let newIndex = selectedIndex;\n\n    if (selectedIndex + 1 >= navigableOptions.length) {\n      newIndex = 0;\n    } else {\n      newIndex++;\n    }\n\n    selectOptionAtIndex(newIndex);\n  }, [navigableOptions, selectOptionAtIndex, selectedIndex]);\n  const selectPreviousOption = useCallback(() => {\n    if (navigableOptions.length === 0) {\n      return;\n    }\n\n    let newIndex = selectedIndex;\n\n    if (selectedIndex <= 0) {\n      newIndex = navigableOptions.length - 1;\n    } else {\n      newIndex--;\n    }\n\n    selectOptionAtIndex(newIndex);\n  }, [navigableOptions, selectOptionAtIndex, selectedIndex]);\n  const selectOptions = useCallback(selected => {\n    selected && onSelect(selected);\n\n    if (!allowMultiple) {\n      resetVisuallySelectedOptions();\n      forcePopoverActiveFalse();\n    }\n  }, [allowMultiple, forcePopoverActiveFalse, onSelect, resetVisuallySelectedOptions]);\n  const handleSelection = useCallback(newSelected => {\n    let newlySelectedOptions = selected;\n\n    if (selected.includes(newSelected)) {\n      newlySelectedOptions.splice(newlySelectedOptions.indexOf(newSelected), 1);\n    } else if (allowMultiple) {\n      newlySelectedOptions.push(newSelected);\n    } else {\n      newlySelectedOptions = [newSelected];\n    }\n\n    selectOptions(newlySelectedOptions);\n  }, [allowMultiple, selectOptions, selected]);\n  const handleEnter = useCallback(event => {\n    if (event.keyCode !== Key.Enter) {\n      return;\n    }\n\n    if (popoverActive && selectedIndex > -1) {\n      const selectedOption = navigableOptions[selectedIndex];\n\n      if (isOption(selectedOption)) {\n        event.preventDefault();\n        handleSelection(selectedOption.value);\n      } else {\n        selectedOption.onAction && selectedOption.onAction();\n      }\n    }\n  }, [handleSelection, navigableOptions, popoverActive, selectedIndex]);\n  const handleBlur = useCallback(() => {\n    forcePopoverActiveFalse();\n    resetVisuallySelectedOptions();\n  }, [forcePopoverActiveFalse, resetVisuallySelectedOptions]);\n  const activatePopover = useCallback(() => {\n    !popoverActive && forcePopoverActiveTrue();\n  }, [forcePopoverActiveTrue, popoverActive]);\n  const updateIndexOfSelectedOption = useCallback(newOptions => {\n    const selectedOption = navigableOptions[selectedIndex];\n\n    if (selectedOption && newOptions.includes(selectedOption)) {\n      selectOptionAtIndex(newOptions.indexOf(selectedOption));\n    } else if (selectedIndex > newOptions.length - 1) {\n      resetVisuallySelectedOptions();\n    } else {\n      selectOptionAtIndex(selectedIndex);\n    }\n  }, [navigableOptions, resetVisuallySelectedOptions, selectOptionAtIndex, selectedIndex]);\n  useEffect(() => {\n    if (selectedOptions !== selected) {\n      setSelectedOptions(selected);\n    }\n  }, [selected, selectedOptions]);\n  useEffect(() => {\n    let newNavigableOptions = [];\n\n    if (actionsBefore) {\n      newNavigableOptions = newNavigableOptions.concat(actionsBefore);\n    }\n\n    if (options) {\n      newNavigableOptions = newNavigableOptions.concat(options);\n    }\n\n    if (actionsAfter) {\n      newNavigableOptions = newNavigableOptions.concat(actionsAfter);\n    }\n\n    newNavigableOptions = assignOptionIds(newNavigableOptions, id);\n    setNavigableOptions(newNavigableOptions);\n  }, [actionsAfter, actionsBefore, id, options]);\n  useEffect(() => {\n    updateIndexOfSelectedOption(navigableOptions);\n  }, [navigableOptions, updateIndexOfSelectedOption]);\n  let actionsBeforeMarkup;\n\n  if (actionsBefore && actionsBefore.length > 0) {\n    actionsBeforeMarkup = /*#__PURE__*/React$1.createElement(ActionList$1, {\n      actionRole: \"option\",\n      items: getActionsWithIds(actionsBefore, true)\n    });\n  }\n\n  let actionsAfterMarkup;\n\n  if (actionsAfter && actionsAfter.length > 0) {\n    actionsAfterMarkup = /*#__PURE__*/React$1.createElement(ActionList$1, {\n      actionRole: \"option\",\n      items: getActionsWithIds(actionsAfter)\n    });\n  }\n\n  const optionsMarkup = options.length > 0 && /*#__PURE__*/React$1.createElement(OptionList$1, {\n    role: \"presentation\",\n    optionRole: \"option\",\n    options: filterForOptions(navigableOptions),\n    onChange: selectOptions,\n    selected: selectedOptions,\n    title: listTitle,\n    allowMultiple: allowMultiple\n  });\n  const emptyStateMarkup = !actionsAfter && !actionsBefore && !contentAfter && !contentBefore && options.length === 0 && emptyState && /*#__PURE__*/React$1.createElement(\"div\", {\n    className: styles.EmptyState\n  }, emptyState);\n  const selectedOptionId = selectedIndex > -1 ? `${id}-${selectedIndex}` : undefined;\n  const context = {\n    id,\n    selectedOptionId\n  };\n  return /*#__PURE__*/React$1.createElement(ComboBoxContext.Provider, {\n    value: context\n  }, /*#__PURE__*/React$1.createElement(\"div\", {\n    onClick: activatePopover,\n    onKeyDown: activatePopover,\n    role: \"combobox\",\n    \"aria-expanded\": popoverActive,\n    \"aria-owns\": id,\n    \"aria-controls\": id,\n    \"aria-haspopup\": true,\n    onFocus: forcePopoverActiveTrue,\n    onBlur: handleBlur,\n    tabIndex: options.length === 0 ? -1 : 0\n  }, /*#__PURE__*/React$1.createElement(KeypressListener$1, {\n    keyCode: Key.DownArrow,\n    handler: selectNextOption\n  }), /*#__PURE__*/React$1.createElement(KeypressListener$1, {\n    keyCode: Key.UpArrow,\n    handler: selectPreviousOption\n  }), /*#__PURE__*/React$1.createElement(EventListener$1, {\n    event: \"keydown\",\n    handler: handleEnter\n  }), /*#__PURE__*/React$1.createElement(KeypressListener$1, {\n    keyCode: Key.Escape,\n    handler: forcePopoverActiveFalse\n  }), /*#__PURE__*/React$1.createElement(Popover$1, {\n    activator: textField,\n    active: popoverActive,\n    onClose: forcePopoverActiveFalse,\n    preferredPosition: preferredPosition,\n    fullWidth: true,\n    preventAutofocus: true\n  }, /*#__PURE__*/React$1.createElement(Popover$1.Pane, {\n    onScrolledToBottom: onEndReached\n  }, /*#__PURE__*/React$1.createElement(\"div\", {\n    id: id,\n    role: \"listbox\",\n    \"aria-multiselectable\": allowMultiple\n  }, contentBefore, actionsBeforeMarkup, optionsMarkup, actionsAfterMarkup, contentAfter, emptyStateMarkup)))));\n}\n\nfunction assignOptionIds(options, id) {\n  return options.map((option, optionIndex) => _objectSpread2(_objectSpread2({}, option), {}, {\n    id: `${id}-${optionIndex}`\n  }));\n}\n\nfunction isOption(navigableOption) {\n  return 'value' in navigableOption && navigableOption.value !== undefined;\n}\n\nfunction filterForOptions(mixedArray) {\n  return mixedArray.filter(isOption);\n}\n\nexport { ComboBox };","map":{"version":3,"sources":["/Users/timi/Desktop/typescript-test/node_modules/@shopify/polaris/dist/esm/components/Autocomplete/components/ComboBox/ComboBox.js"],"names":["Key","objectSpread2","_objectSpread2","React$1","useState","useCallback","useEffect","EventListener","EventListener$1","useUniqueId","KeypressListener","KeypressListener$1","Popover","Popover$1","ActionList","ActionList$1","useToggle","useToggle$1","OptionList","OptionList$1","ComboBoxContext","styles","ComboBox","id","idProp","options","selected","textField","preferredPosition","listTitle","allowMultiple","actionsBefore","actionsAfter","contentBefore","contentAfter","emptyState","onSelect","onEndReached","selectedIndex","setSelectedIndex","selectedOptions","setSelectedOptions","navigableOptions","setNavigableOptions","value","popoverActive","setTrue","forcePopoverActiveTrue","setFalse","forcePopoverActiveFalse","getActionsWithIds","actions","before","slice","length","visuallyUpdateSelectedOption","newOption","oldOption","active","resetVisuallySelectedOptions","forEach","option","selectOptionAtIndex","newOptionIndex","oldSelectedOption","newSelectedOption","selectNextOption","newIndex","selectPreviousOption","selectOptions","handleSelection","newSelected","newlySelectedOptions","includes","splice","indexOf","push","handleEnter","event","keyCode","Enter","selectedOption","isOption","preventDefault","onAction","handleBlur","activatePopover","updateIndexOfSelectedOption","newOptions","newNavigableOptions","concat","assignOptionIds","actionsBeforeMarkup","createElement","actionRole","items","actionsAfterMarkup","optionsMarkup","role","optionRole","filterForOptions","onChange","title","emptyStateMarkup","className","EmptyState","selectedOptionId","undefined","context","Provider","onClick","onKeyDown","onFocus","onBlur","tabIndex","DownArrow","handler","UpArrow","Escape","activator","onClose","fullWidth","preventAutofocus","Pane","onScrolledToBottom","map","optionIndex","navigableOption","mixedArray","filter"],"mappings":"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","sourcesContent":["import { Key } from '../../../../types.js';\nimport { objectSpread2 as _objectSpread2 } from '../../../../_virtual/_rollupPluginBabelHelpers.js';\nimport React$1, { useState, useCallback, useEffect } from 'react';\nimport { EventListener as EventListener$1 } from '../../../EventListener/EventListener.js';\nimport { useUniqueId } from '../../../../utilities/unique-id/hooks.js';\nimport { KeypressListener as KeypressListener$1 } from '../../../KeypressListener/KeypressListener.js';\nimport { Popover as Popover$1 } from '../../../Popover/Popover.js';\nimport { ActionList as ActionList$1 } from '../../../ActionList/ActionList.js';\nimport { useToggle as useToggle$1 } from '../../../../utilities/use-toggle.js';\nimport { OptionList as OptionList$1 } from '../../../OptionList/OptionList.js';\nimport { ComboBoxContext } from './context.js';\nimport styles from './ComboBox.scss.js';\n\nfunction ComboBox({\n  id: idProp,\n  options,\n  selected,\n  textField,\n  preferredPosition,\n  listTitle,\n  allowMultiple,\n  actionsBefore,\n  actionsAfter,\n  contentBefore,\n  contentAfter,\n  emptyState,\n  onSelect,\n  onEndReached\n}) {\n  const [selectedIndex, setSelectedIndex] = useState(-1);\n  const [selectedOptions, setSelectedOptions] = useState(selected);\n  const [navigableOptions, setNavigableOptions] = useState([]);\n  const {\n    value: popoverActive,\n    setTrue: forcePopoverActiveTrue,\n    setFalse: forcePopoverActiveFalse\n  } = useToggle$1(false);\n  const id = useUniqueId('ComboBox', idProp);\n  const getActionsWithIds = useCallback((actions, before) => {\n    if (before) {\n      return navigableOptions.slice(0, actions.length);\n    }\n\n    return navigableOptions.slice(-actions.length);\n  }, [navigableOptions]);\n  const visuallyUpdateSelectedOption = useCallback((newOption, oldOption) => {\n    if (oldOption) {\n      oldOption.active = false;\n    }\n\n    if (newOption) {\n      newOption.active = true;\n    }\n  }, []);\n  const resetVisuallySelectedOptions = useCallback(() => {\n    setSelectedIndex(-1);\n    navigableOptions.forEach(option => {\n      option.active = false;\n    });\n  }, [navigableOptions]);\n  const selectOptionAtIndex = useCallback(newOptionIndex => {\n    if (navigableOptions.length === 0) {\n      return;\n    }\n\n    const oldSelectedOption = navigableOptions[selectedIndex];\n    const newSelectedOption = navigableOptions[newOptionIndex];\n    visuallyUpdateSelectedOption(newSelectedOption, oldSelectedOption);\n    setSelectedIndex(newOptionIndex);\n  }, [navigableOptions, selectedIndex, visuallyUpdateSelectedOption]);\n  const selectNextOption = useCallback(() => {\n    if (navigableOptions.length === 0) {\n      return;\n    }\n\n    let newIndex = selectedIndex;\n\n    if (selectedIndex + 1 >= navigableOptions.length) {\n      newIndex = 0;\n    } else {\n      newIndex++;\n    }\n\n    selectOptionAtIndex(newIndex);\n  }, [navigableOptions, selectOptionAtIndex, selectedIndex]);\n  const selectPreviousOption = useCallback(() => {\n    if (navigableOptions.length === 0) {\n      return;\n    }\n\n    let newIndex = selectedIndex;\n\n    if (selectedIndex <= 0) {\n      newIndex = navigableOptions.length - 1;\n    } else {\n      newIndex--;\n    }\n\n    selectOptionAtIndex(newIndex);\n  }, [navigableOptions, selectOptionAtIndex, selectedIndex]);\n  const selectOptions = useCallback(selected => {\n    selected && onSelect(selected);\n\n    if (!allowMultiple) {\n      resetVisuallySelectedOptions();\n      forcePopoverActiveFalse();\n    }\n  }, [allowMultiple, forcePopoverActiveFalse, onSelect, resetVisuallySelectedOptions]);\n  const handleSelection = useCallback(newSelected => {\n    let newlySelectedOptions = selected;\n\n    if (selected.includes(newSelected)) {\n      newlySelectedOptions.splice(newlySelectedOptions.indexOf(newSelected), 1);\n    } else if (allowMultiple) {\n      newlySelectedOptions.push(newSelected);\n    } else {\n      newlySelectedOptions = [newSelected];\n    }\n\n    selectOptions(newlySelectedOptions);\n  }, [allowMultiple, selectOptions, selected]);\n  const handleEnter = useCallback(event => {\n    if (event.keyCode !== Key.Enter) {\n      return;\n    }\n\n    if (popoverActive && selectedIndex > -1) {\n      const selectedOption = navigableOptions[selectedIndex];\n\n      if (isOption(selectedOption)) {\n        event.preventDefault();\n        handleSelection(selectedOption.value);\n      } else {\n        selectedOption.onAction && selectedOption.onAction();\n      }\n    }\n  }, [handleSelection, navigableOptions, popoverActive, selectedIndex]);\n  const handleBlur = useCallback(() => {\n    forcePopoverActiveFalse();\n    resetVisuallySelectedOptions();\n  }, [forcePopoverActiveFalse, resetVisuallySelectedOptions]);\n  const activatePopover = useCallback(() => {\n    !popoverActive && forcePopoverActiveTrue();\n  }, [forcePopoverActiveTrue, popoverActive]);\n  const updateIndexOfSelectedOption = useCallback(newOptions => {\n    const selectedOption = navigableOptions[selectedIndex];\n\n    if (selectedOption && newOptions.includes(selectedOption)) {\n      selectOptionAtIndex(newOptions.indexOf(selectedOption));\n    } else if (selectedIndex > newOptions.length - 1) {\n      resetVisuallySelectedOptions();\n    } else {\n      selectOptionAtIndex(selectedIndex);\n    }\n  }, [navigableOptions, resetVisuallySelectedOptions, selectOptionAtIndex, selectedIndex]);\n  useEffect(() => {\n    if (selectedOptions !== selected) {\n      setSelectedOptions(selected);\n    }\n  }, [selected, selectedOptions]);\n  useEffect(() => {\n    let newNavigableOptions = [];\n\n    if (actionsBefore) {\n      newNavigableOptions = newNavigableOptions.concat(actionsBefore);\n    }\n\n    if (options) {\n      newNavigableOptions = newNavigableOptions.concat(options);\n    }\n\n    if (actionsAfter) {\n      newNavigableOptions = newNavigableOptions.concat(actionsAfter);\n    }\n\n    newNavigableOptions = assignOptionIds(newNavigableOptions, id);\n    setNavigableOptions(newNavigableOptions);\n  }, [actionsAfter, actionsBefore, id, options]);\n  useEffect(() => {\n    updateIndexOfSelectedOption(navigableOptions);\n  }, [navigableOptions, updateIndexOfSelectedOption]);\n  let actionsBeforeMarkup;\n\n  if (actionsBefore && actionsBefore.length > 0) {\n    actionsBeforeMarkup = /*#__PURE__*/React$1.createElement(ActionList$1, {\n      actionRole: \"option\",\n      items: getActionsWithIds(actionsBefore, true)\n    });\n  }\n\n  let actionsAfterMarkup;\n\n  if (actionsAfter && actionsAfter.length > 0) {\n    actionsAfterMarkup = /*#__PURE__*/React$1.createElement(ActionList$1, {\n      actionRole: \"option\",\n      items: getActionsWithIds(actionsAfter)\n    });\n  }\n\n  const optionsMarkup = options.length > 0 && /*#__PURE__*/React$1.createElement(OptionList$1, {\n    role: \"presentation\",\n    optionRole: \"option\",\n    options: filterForOptions(navigableOptions),\n    onChange: selectOptions,\n    selected: selectedOptions,\n    title: listTitle,\n    allowMultiple: allowMultiple\n  });\n  const emptyStateMarkup = !actionsAfter && !actionsBefore && !contentAfter && !contentBefore && options.length === 0 && emptyState && /*#__PURE__*/React$1.createElement(\"div\", {\n    className: styles.EmptyState\n  }, emptyState);\n  const selectedOptionId = selectedIndex > -1 ? `${id}-${selectedIndex}` : undefined;\n  const context = {\n    id,\n    selectedOptionId\n  };\n  return /*#__PURE__*/React$1.createElement(ComboBoxContext.Provider, {\n    value: context\n  }, /*#__PURE__*/React$1.createElement(\"div\", {\n    onClick: activatePopover,\n    onKeyDown: activatePopover,\n    role: \"combobox\",\n    \"aria-expanded\": popoverActive,\n    \"aria-owns\": id,\n    \"aria-controls\": id,\n    \"aria-haspopup\": true,\n    onFocus: forcePopoverActiveTrue,\n    onBlur: handleBlur,\n    tabIndex: options.length === 0 ? -1 : 0\n  }, /*#__PURE__*/React$1.createElement(KeypressListener$1, {\n    keyCode: Key.DownArrow,\n    handler: selectNextOption\n  }), /*#__PURE__*/React$1.createElement(KeypressListener$1, {\n    keyCode: Key.UpArrow,\n    handler: selectPreviousOption\n  }), /*#__PURE__*/React$1.createElement(EventListener$1, {\n    event: \"keydown\",\n    handler: handleEnter\n  }), /*#__PURE__*/React$1.createElement(KeypressListener$1, {\n    keyCode: Key.Escape,\n    handler: forcePopoverActiveFalse\n  }), /*#__PURE__*/React$1.createElement(Popover$1, {\n    activator: textField,\n    active: popoverActive,\n    onClose: forcePopoverActiveFalse,\n    preferredPosition: preferredPosition,\n    fullWidth: true,\n    preventAutofocus: true\n  }, /*#__PURE__*/React$1.createElement(Popover$1.Pane, {\n    onScrolledToBottom: onEndReached\n  }, /*#__PURE__*/React$1.createElement(\"div\", {\n    id: id,\n    role: \"listbox\",\n    \"aria-multiselectable\": allowMultiple\n  }, contentBefore, actionsBeforeMarkup, optionsMarkup, actionsAfterMarkup, contentAfter, emptyStateMarkup)))));\n}\n\nfunction assignOptionIds(options, id) {\n  return options.map((option, optionIndex) => _objectSpread2(_objectSpread2({}, option), {}, {\n    id: `${id}-${optionIndex}`\n  }));\n}\n\nfunction isOption(navigableOption) {\n  return 'value' in navigableOption && navigableOption.value !== undefined;\n}\n\nfunction filterForOptions(mixedArray) {\n  return mixedArray.filter(isOption);\n}\n\nexport { ComboBox };\n"]},"metadata":{},"sourceType":"module"}